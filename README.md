# Ответ на тестовое задание DevOps-Docker
## Дано
Создать Docker Compose скрипт для развертки кластера из трех инстансов cassandra, причем каждый из них должен быть доступен из основной (локальной) сети по отдельному ip адресу.

1. На машине А (ubuntu 22.04 lts) в локальной сети с ip 192.168.1.197 запускается скрипт docker-compose для поднятия 3 образов с ip адресами 192.168.1.200-202.
2. Затем с машины Б (ubuntu 22.04 lts) из той же локальной сети с ip 192.168.1.198 необходимо подключиться через cqlsh к каждой из машин-образов.
3. Все приведённые операции необходимо задокументировать и описать инструкцией с командами и объяснениями в Readme
4. Добавить скриншот результата в Readme.

Так как полностью реализовать задание не получилось, приведу успешные кейсы, которые удалось проработать.
## Кластер через bridge
В данном случае приводится простая рабочая конфигурация через bridgeб при этом доступность всех контейнеров по cqlsh сохраняется как с хоста 192.168.1.197 так и с 192.168.1.198.

### Запуск
```sh
    sudo docker-compose -f cassandra-cluster_bridge.yaml up -d
```

### Результат
![image](https://github.com/user-attachments/assets/0a47790b-88ad-4e20-8b3b-015ac48d7208)

## Кластер через macvlan
В данном случае задействован macvlan и роутинг из докер сети (macvlan) в хост контейнеров (192.168.1.197).
В самом простом случае будут работать следующий docker-compose файл:

### Запуск
```sh
    sudo docker-compose -f cassandra-cluster_macvlan.yaml up -d
```
У некоторых работает без дополнительных действий, в моем случае нужно полнять виртуальный интерфейс и проложиь маршрут из докера на хост. Скорее всего, это связанно с изолированностью сетей докера.
Для этого я использую скрипт, который настроит интерфейс и сделает сервис, чтобы настройки не сбили при перезагрузке.

Права на исполнение:
```sh
    sudo chmod +x setup_macvlan.sh
```
Запуск:
```sh
    sudo ./setup_macvlan.sh
```

На хосте 192.168.1.198 нужно настроить маршрут. В таком случае контейнеры будут доступны через ping, но не через cqlsh

```sh
    sudo ip route add 192.168.1.200/30 via 192.168.1.199
```

### Результат
Приведу пример из хосат 192.168.1.197
#### Ping
![image](https://github.com/user-attachments/assets/f1d2d4ff-b69d-4752-b685-45dfd68ca860)

#### cqlsh
![image](https://github.com/user-attachments/assets/f94a2d82-2517-4093-a7cf-739024b558f7)
